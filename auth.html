<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLOEX.ORG | Login / Register</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Define custom Tailwind colors using the extended palette for a clean green */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f8f7; /* Off-white/light-green background */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-emerald-800 shadow-xl p-4 sticky top-0 z-20">
        <div class="container mx-auto flex justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <img src="1-1.png" alt="GLOEX.ORG Logo" class="w-10 h-10 hidden sm:block"> 
                <h1 class="text-3xl font-extrabold text-white">
                    <a href="index.html" class="hover:text-amber-300 transition">GLOEX.ORG</a>
                </h1>
            </div>
            <a href="index.html" class="text-white hover:text-amber-300 transition">‚Üê Back to Hub</a>
        </div>
    </header>

    <main class="container mx-auto p-4 flex-grow flex items-start justify-center pt-16">
        <div id="auth-container">
            </div>
    </main>

    <footer class="bg-emerald-900 text-white p-8 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <div class="mt-4 border-t border-emerald-700 pt-4">
                <p class="text-sm font-light">Address: Kigali, Rwanda</p>
                <p class="text-xs text-emerald-400 mt-1">TWUBAKA-WEB | &copy; 2025 ELIJUL GROUPS LTD</p>
            </div>
        </div>
    </footer>

    <div id="message-box" class="fixed top-5 left-1/2 transform -translate-x-1/2 p-3 rounded-lg shadow-xl text-white font-semibold z-[100] transition-all duration-300 opacity-0 pointer-events-none"></div>

    <script>
        // --- Configuration ---
        const API_BASE_URL = 'https://gloex.pythonanywhere.com/api';
        let currentState = {
            view: 'login', // Default to login page
        };

        // --- Utility Functions ---
        function getCsrfToken() {
            const token = document.cookie.split(';').find(c => c.trim().startsWith('csrftoken='));
            return token ? decodeURIComponent(token.split('=')[1]) : null;
        }

        function showMessage(text, type = 'success') {
            const box = document.getElementById('message-box');
            box.textContent = text;
            box.style.opacity = 1;
            box.classList.remove('bg-green-600', 'bg-red-600'); 
            box.classList.add(type === 'success' ? 'bg-green-600' : 'bg-red-600'); 
            setTimeout(() => { box.style.opacity = 0; }, 3500);
        }

        async function fetchData(url, options = {}) {
            const defaultHeaders = { 'Content-Type': 'application/json' };
            const config = { credentials: 'include', ...options, headers: { ...defaultHeaders, ...options.headers } };

            if (options.method && options.method !== 'GET' && !(options.body instanceof FormData)) {
                const csrfToken = getCsrfToken();
                if (csrfToken) config.headers['X-CSRFToken'] = csrfToken;
            }
            if (options.body instanceof FormData) {
                delete config.headers['Content-Type']; 
            }

            const response = await fetch(url, config);
            const contentType = response.headers.get("content-type");

            if (!response.ok) {
                const errorData = contentType?.includes("application/json") ? await response.json() : { error: `HTTP error! Status: ${response.status}` };
                throw new Error(errorData.error || `Request failed.`);
            }

            return contentType?.includes("application/json") ? response.json() : response;
        }

        // --- Auth Logic ---
        async function handleAuthForm(event, endpoint) {
            event.preventDefault();
            const data = Object.fromEntries(new FormData(event.target).entries());
            try {
                const user = await fetchData(`${API_BASE_URL}/${endpoint}/`, { method: 'POST', body: JSON.stringify(data) });
                // On successful login/register, redirect to the main index page
                window.location.href = 'index.html'; 
            } catch (error) {
                showMessage(`Authentication failed: ${error.message}`, 'error');
            }
        }

        function renderLoginForm() { 
             return `<form onsubmit="handleAuthForm(event, 'login')">
                    <div class="mb-4"><label for="u_login" class="block text-sm font-medium text-gray-700">Username</label><input type="text" id="u_login" name="username" required class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500"></div>
                    <div class="mb-5"><label for="p_login" class="block text-sm font-medium text-gray-700">Password</label><input type="password" id="p_login" name="password" required class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500"></div>
                    <button type="submit" class="w-full bg-emerald-600 text-white p-3 rounded-lg font-semibold hover:bg-emerald-700 transition shadow">Sign In</button>
                </form>`;
        }
        function renderRegisterForm() { 
             return `<form onsubmit="handleAuthForm(event, 'register')">
                    <div class="mb-4"><label for="u_reg" class="block text-sm font-medium text-gray-700">Username</label><input type="text" id="u_reg" name="username" required class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500"></div>
                    <div class="mb-4"><label for="e_reg" class="block text-sm font-medium text-gray-700">Email</label><input type="email" id="e_reg" name="email" class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500"></div>
                    <div class="mb-5"><label for="p_reg" class="block text-sm font-medium text-gray-700">Password</label><input type="password" id="p_reg" name="password" required class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500"></div>
                    <button type="submit" class="w-full bg-emerald-600 text-white p-3 rounded-lg font-semibold hover:bg-emerald-700 transition shadow">Create Account</button>
                </form>`;
        }

        function renderAuthView() {
            const container = document.getElementById('auth-container');
            container.innerHTML = `
                <div class="max-w-md mx-auto p-8 bg-white rounded-xl shadow-2xl border-t-4 border-emerald-600">
                    <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Access Hub</h2>
                    <div class="flex border border-gray-200 rounded-lg p-1 mb-6">
                        <button onclick="currentState.view='login'; renderApp()" class="flex-1 p-2 text-center rounded-md font-medium transition ${currentState.view === 'login' ? 'bg-emerald-600 text-white shadow' : 'text-gray-600 hover:bg-gray-100'}">Login</button>
                        <button onclick="currentState.view='register'; renderApp()" class="flex-1 p-2 text-center rounded-md font-medium transition ${currentState.view === 'register' ? 'bg-emerald-600 text-white shadow' : 'text-gray-600 hover:bg-gray-100'}">Register</button>
                    </div>
                    ${currentState.view === 'login' ? renderLoginForm() : renderRegisterForm()}
                </div>`;
        }

        function renderApp() {
            renderAuthView();
        }

        // --- Initialization ---
        function init() {
            // Check URL parameters to see if we should display login or register by default
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('redirect') === 'register') {
                 currentState.view = 'register';
            } else {
                 currentState.view = 'login';
            }
            renderApp();
        }

        window.onload = init;
    </script>
</body>
</html>
