<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gloEx Project Hub - Innovation Showcase</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Set Inter Font as default -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Load Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, query, onSnapshot, addDoc, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Global Firebase and Application Variables ---
        // These variables are provided by the canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Set Firebase logging level
        setLogLevel('error'); 
        
        let app = null;
        let db = null;
        let auth = null;
        let userId = null;

        // --- Application State Management (Central Feature) ---
        // This object controls the current view and data displayed.
        window.currentState = {
            view: 'dashboard', // 'dashboard', 'project-details', 'upload'
            selectedProjectId: null,
            projects: [],
            isAuthReady: false,
            searchText: ''
        };
        
        // --- Firebase Initialization and Authentication ---
        const initFirebase = async () => {
            if (!firebaseConfig) {
                console.error("Firebase config is missing. Data persistence will be unavailable.");
                window.currentState.isAuthReady = true;
                return;
            }
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    userId = user?.uid || crypto.randomUUID();
                    window.currentState.isAuthReady = true;
                    console.log("Firebase Auth Ready. User ID:", userId);
                    startProjectListener(); // Start listening for data once authenticated
                });

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                window.currentState.isAuthReady = true;
            }
        };

        // --- Firestore Data Management (The working feature) ---
        const getProjectsCollectionRef = () => {
            // Using public data storage for a shared project showcase
            return collection(db, `artifacts/${appId}/public/data/projects`);
        };

        const startProjectListener = () => {
             if (!db) { return; }

             const q = query(getProjectsCollectionRef());

             onSnapshot(q, (snapshot) => {
                const projects = [];
                snapshot.forEach((doc) => {
                    projects.push({ id: doc.id, ...doc.data() });
                });
                // Sort by creation time (descending) in memory
                projects.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                
                // If the database is empty, fall back to mock data
                if (projects.length === 0) {
                     window.currentState.projects = mockProjects;
                } else {
                     window.currentState.projects = projects;
                }
                
                window.renderApp(); // Re-render the app on data change
             }, (error) => {
                 console.error("Error listening to projects:", error);
             });
        };

        window.submitNewProject = async (projectData) => {
            if (!db) { 
                console.error("Database not initialized.");
                showMessage("Submission failed: Database not ready.", 'error'); 
                return; 
            }
            try {
                const newProject = {
                    ...projectData,
                    authorId: userId,
                    createdAt: serverTimestamp()
                };
                await addDoc(getProjectsCollectionRef(), newProject);
                window.currentState.view = 'dashboard';
                window.renderApp();
                showMessage("Success! Your project has been submitted.", 'success');
            } catch (e) {
                console.error("Error adding document: ", e);
                showMessage("Submission failed. Check console for details.", 'error');
            }
        };
        
        initFirebase();
    </script>
    
    <style>
        /* Base Styles and Green Theme */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7; 
            color: #1f2937;
        }

        /* Green Button Styles */
        .green-button {
            background-color: #059669; /* Emerald 600 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .green-button:hover {
            background-color: #047857; /* Emerald 700 */
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Custom Wave Animation for Hero Section (Animated Picture) */
        .wave-animation {
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
        }
        .wave {
            position: absolute;
            width: 200%;
            height: 200%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 40%;
            opacity: 0.3;
        }
        .wave-1 {
            background: #38bdf8; /* Sky Blue */
            animation: wave-motion 15s linear infinite;
        }
        .wave-2 {
            background: #f472b6; /* Rose Pink */
            animation: wave-motion 20s linear infinite reverse;
        }
        @keyframes wave-motion {
            0% { transform: translate(-50%, -50%) rotate(0deg) scale(1.0); }
            50% { transform: translate(-50%, -50%) rotate(180deg) scale(1.1); }
            100% { transform: translate(-50%, -50%) rotate(360deg) scale(1.0); }
        }

        /* Utility for line clamping */
        .line-clamp-3 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;
        }

        /* Custom Scrollbar for better UX */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #059669; /* Green */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-track {
            background-color: #e5e7eb;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Message Box Placeholder -->
    <div id="messageBox" class="fixed top-4 right-4 z-50 transition-opacity duration-300"></div>

    <!-- HEADER (Green) -->
    <header class="bg-emerald-600 shadow-2xl p-4 sticky top-0 z-20">
        <div class="container mx-auto flex flex-wrap justify-between items-center gap-4">
            <!-- Logo (Well Positioned and Animated) -->
            <h1 class="text-3xl font-extrabold text-white tracking-wider animate-pulse">
                <a href="#" onclick="window.currentState.view='dashboard'; window.renderApp(); return false;" id="appTitle" class="transition duration-300 hover:text-emerald-200">
                    <span class="text-emerald-300">G</span>loEx <span class="text-emerald-300">H</span>ub
                </a>
            </h1>
            
            <!-- Search Bar (Well Positioned) -->
            <div class="flex-grow max-w-xl">
                <div class="relative">
                    <input 
                        type="search" 
                        placeholder="Search projects, authors, or tags..." 
                        id="searchInput"
                        oninput="window.currentState.searchText = this.value; window.renderApp();"
                        class="w-full py-2 pl-10 pr-4 rounded-full border-2 border-emerald-400 focus:outline-none focus:border-white text-gray-800 bg-white shadow-inner transition duration-300"
                    >
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
            </div>

            <!-- Navigation Buttons (Green) -->
            <nav class="flex space-x-3">
                <button 
                    onclick="window.currentState.view='upload'; window.renderApp();" 
                    class="green-button text-sm md:text-base px-4 py-2 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 shadow-lg whitespace-nowrap">
                    Upload Demo
                </button>
                <a href="https://www.gloex.org" target="_blank" class="green-button bg-transparent border-2 border-white text-white text-sm md:text-base px-4 py-2 hover:bg-white hover:text-emerald-700 focus:ring-4 focus:ring-emerald-300 transition duration-300 shadow-lg">
                    Main Site
                </a>
            </nav>
        </div>
    </header>

    <!-- MAIN CONTENT CONTAINER -->
    <main id="appContainer" class="flex-grow"></main>

    <!-- FOOTER (Green) -->
    <footer class="bg-emerald-800 text-white p-8 mt-auto shadow-inner">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-4 gap-8">
            
            <!-- Section 1: Contact Info (Reused from original snippet) -->
            <div class="contact-info">
                <h3 class="text-xl font-bold mb-3 text-emerald-200">Ready to Start Your Project?</h3>
                <p class="text-sm mb-4">Contact the ELIJUL GROUPS LTD team today.</p>
                
                <p class="mb-1 text-sm">
                    <span class="font-semibold text-emerald-300">Website:</span> 
                    <a href="https://www.gloex.org" target="_blank" class="text-emerald-100 hover:text-white transition duration-200">WWW.GLOEX.ORG</a>
                </p>
                <p class="mb-1 text-sm">
                    <span class="font-semibold text-emerald-300">Email (Web/Software):</span> 
                    <a href="mailto:infogloex@proton.me" class="text-emerald-100 hover:text-white transition duration-200">infogloex@proton.me</a>
                </p>
                <p class="mb-1 text-sm">
                    <span class="font-semibold text-emerald-300">Email (Partnership):</span> 
                    <a href="mailto:info@gloex.org" class="text-emerald-100 hover:text-white transition duration-200">info@gloex.org</a>
                </p>
                <p class="mb-1 text-sm">
                    <span class="font-semibold text-emerald-300">Phone/WhatsApp:</span> +250 788 660 513
                </p>
                <p class="mt-4 text-sm opacity-80">
                    Address: Kigali, Rwanda
                </p>
            </div>

            <!-- Section 2: Quick Links (Green) -->
            <div>
                <h3 class="text-xl font-bold mb-3 text-emerald-200">Quick Links</h3>
                <ul class="space-y-2 text-sm">
                    <li><a href="#" onclick="window.currentState.view='dashboard'; window.renderApp(); return false;" class="text-emerald-100 hover:text-white transition duration-200">Project Dashboard</a></li>
                    <li><a href="https://www.gloex.org/about" target="_blank" class="text-emerald-100 hover:text-white transition duration-200">About Us</a></li>
                    <li><a href="https://www.gloex.org/services" target="_blank" class="text-emerald-100 hover:text-white transition duration-200">Our Services</a></li>
                    <li><a href="#" class="text-emerald-100 hover:text-white transition duration-200">Privacy Policy</a></li>
                </ul>
            </div>

            <!-- Section 3: Project Links -->
            <div>
                <h3 class="text-xl font-bold mb-3 text-emerald-200">Get Free Projects</h3>
                <ul class="space-y-2 text-sm">
                    <!-- Replicating the "DOWNLOAD FREE PROJECTS" links -->
                    <li><a href="https://github.com/" target="_blank" class="text-emerald-100 hover:text-white transition duration-200">Web Development Demos</a></li>
                    <li><a href="https://github.com/" target="_blank" class="text-emerald-100 hover:text-white transition duration-200">Data Science Templates</a></li>
                    <li><a href="https://github.com/" target="_blank" class="text-emerald-100 hover:text-white transition duration-200">Mobile App Snippets</a></li>
                    <li><a href="https://github.com/" target="_blank" class="text-emerald-100 hover:text-white transition duration-200">Open Source Utilities</a></li>
                </ul>
            </div>

            <!-- Section 4: Call to Action (More Attractive CTA) -->
             <div class="text-center md:text-left">
                <h3 class="text-xl font-bold mb-3 text-emerald-200">Join the Community</h3>
                <p class="mb-4 text-sm">Share your innovation and connect with global developers.</p>
                <button 
                    onclick="window.currentState.view='upload'; window.renderApp();" 
                    class="green-button font-bold py-3 px-6 rounded-lg hover:bg-emerald-600 focus:ring-4 focus:ring-emerald-300 w-full md:w-auto transition duration-300">
                    START SHARING NOW
                </button>
            </div>
        </div>

        <!-- Copyright (Reused Footer Logo Text) -->
        <div class="mt-8 pt-4 border-t border-emerald-700 text-center text-sm opacity-75">
            <p> &copy; 2025 ELIJUL GROUPS LTD. TWUBAKA-UBUMENYI. All rights reserved.</p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // Placeholder Project Data (Used if Firestore data is empty or unavailable)
        const mockProjects = [
            { id: 'p1', title: 'AI-Powered Stock Predictor', description: 'A Python-based machine learning model using LSTM networks to forecast stock market trends. Includes a web interface for real-time data.', image: 'https://placehold.co/400x250/0ea5e9/ffffff?text=AI+Model', tags: ['AI', 'Python', 'Finance'], author: 'Jane Doe', views: 1200, demoUrl: 'https://github.com/gloex-ai-finance' },
            { id: 'p2', title: 'Modern React E-commerce UI', description: 'A sleek, responsive e-commerce front-end built with React and Tailwind CSS, focusing on mobile-first design and accessibility. Integrates dummy payment API.', image: 'https://placehold.co/400x250/ec4899/ffffff?text=React+UI', tags: ['React', 'WebDev', 'Frontend'], author: 'John Smith', views: 850, demoUrl: 'https://github.com/gloex-react-shop' },
            { id: 'p3', title: 'Open Source IoT Dashboard', description: 'Real-time data visualization dashboard for home automation sensors using Node.js and D3.js. Easily extendable architecture for new sensors.', image: 'https://placehold.co/400x250/22c55e/000000?text=IoT+Dashboard', tags: ['IoT', 'Node.js', 'DataViz'], author: 'Alice Brown', views: 420, demoUrl: 'https://github.com/gloex-iot-dash' },
        ];
        
        // Use mock data until Firebase connects
        if (window.currentState.projects.length === 0) {
            window.currentState.projects = mockProjects;
        }

        const appContainer = document.getElementById('appContainer');

        /**
         * Custom message box function (replaces alert())
         * @param {string} message 
         * @param {string} type 'success' or 'error'
         */
        function showMessage(message, type) {
            const box = document.getElementById('messageBox');
            const colorClass = type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700';
            
            box.innerHTML = `
                <div class="shadow-xl px-4 py-3 rounded relative border ${colorClass}" role="alert">
                    <strong class="font-bold">${type === 'success' ? 'Success!' : 'Error!'}</strong>
                    <span class="block sm:inline ml-2">${message}</span>
                </div>
            `;
            box.classList.remove('opacity-0');
            box.classList.add('opacity-100');

            setTimeout(() => {
                box.classList.remove('opacity-100');
                box.classList.add('opacity-0');
                setTimeout(() => box.innerHTML = '', 300);
            }, 3000);
        }


        // --- View Rendering Functions ---

        // 1. Dashboard View
        const renderDashboard = () => {
            const { projects, searchText } = window.currentState;

            // Filter logic (working feature)
            const filteredProjects = projects.filter(p => 
                (p.title || '').toLowerCase().includes(searchText.toLowerCase()) || 
                (p.description || '').toLowerCase().includes(searchText.toLowerCase()) ||
                (p.author || '').toLowerCase().includes(searchText.toLowerCase()) ||
                (p.tags || []).some(tag => tag.toLowerCase().includes(searchText.toLowerCase()))
            );

            // Generate a single project card (Attractive Cards)
            const generateProjectCard = (project) => {
                const isBlue = project.id.charCodeAt(project.id.length - 1) % 2 === 0;
                const bgColor = isBlue ? 'bg-sky-50' : 'bg-rose-50';
                const borderColor = isBlue ? 'border-sky-300' : 'border-rose-300';
                const textColor = isBlue ? 'text-sky-800' : 'text-rose-800';
                const tagColor = isBlue ? 'bg-sky-200 text-sky-800' : 'bg-rose-200 text-rose-800';

                return `
                    <div onclick="window.currentState.selectedProjectId='${project.id}'; window.currentState.view='project-details'; window.renderApp();" 
                         class="transform transition duration-500 hover:scale-[1.03] cursor-pointer rounded-xl overflow-hidden shadow-xl ${bgColor} border ${borderColor} flex flex-col h-full hover:shadow-2xl">
                        <img src="${project.image}" alt="${project.title} Preview" class="w-full h-48 object-cover transition duration-300 hover:opacity-90" onerror="this.onerror=null; this.src='https://placehold.co/400x250/f7f7f7/6b7280?text=Image+Missing'">
                        <div class="p-6 flex flex-col justify-between flex-grow">
                            <div>
                                <h3 class="font-extrabold text-xl mb-2 ${textColor} truncate">${project.title}</h3>
                                <p class="text-gray-600 text-sm line-clamp-3 mb-4">${project.description}</p>
                            </div>
                            <div>
                                <div class="flex flex-wrap gap-2 mb-4">
                                    ${(project.tags || []).map(tag => `<span class="text-xs font-semibold px-3 py-1 rounded-full ${tagColor}">${tag}</span>`).join('')}
                                </div>
                                <a href="${project.demoUrl}" target="_blank" onclick="event.stopPropagation();" 
                                   class="green-button inline-flex items-center justify-center text-sm w-full transition duration-300 hover:ring-2 hover:ring-offset-2 hover:ring-emerald-500">
                                    <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                                    View Demo
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            };

            appContainer.innerHTML = `
                <!-- HERO SECTION (Blue/Pink Section & Animated Picture) -->
                <section class="bg-gradient-to-br from-sky-50 to-rose-50 p-8 md:p-16 relative overflow-hidden">
                    <div class="wave-animation absolute inset-0">
                        <div class="wave wave-1"></div>
                        <div class="wave wave-2"></div>
                    </div>

                    <div class="container mx-auto flex flex-col md:flex-row items-center gap-12 relative z-10">
                        <!-- Hero Text and CTA -->
                        <div class="md:w-1/2 text-center md:text-left">
                            <h2 class="text-5xl md:text-6xl font-extrabold text-gray-900 mb-4 leading-tight">
                                <span class="text-emerald-600">Accelerate</span> Your Innovation Pipeline.
                            </h2>
                            <p class="text-xl text-gray-700 mb-8">
                                The gloEx Hub is a curated showcase for working demosâ€”where brilliant code meets opportunity.
                            </p>
                            
                            <!-- Attractive Call to Actions (Green) -->
                            <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                                <button 
                                    onclick="window.currentState.view='upload'; window.renderApp();" 
                                    class="green-button text-lg shadow-xl hover:ring-4 hover:ring-offset-2 hover:ring-emerald-300">
                                    <span class="animate-pulse">SHARE YOUR PROJECT</span>
                                </button>
                                <a href="#projects" class="green-button bg-transparent border-2 border-emerald-600 text-emerald-800 font-bold hover:bg-emerald-600 hover:text-white transition duration-300 shadow-lg">
                                    BROWSE LATEST
                                </a>
                            </div>
                        </div>

                        <!-- Animated Picture (Well Positioned) -->
                        <div class="md:w-1/2 h-64 md:h-96 relative flex items-center justify-center">
                            <!-- High-Tech Icon as the animated picture placeholder -->
                            <svg class="w-32 h-32 md:w-56 md:h-56 text-emerald-500/70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                    </div>
                </section>

                <!-- PROJECTS GRID SECTION -->
                <section id="projects" class="container mx-auto px-4 py-16">
                    <div class="flex justify-between items-center mb-10">
                        <h2 class="text-4xl font-extrabold text-gray-900 border-b-4 border-rose-500 pb-2">
                            Latest Demos (${filteredProjects.length})
                        </h2>
                    </div>

                    ${filteredProjects.length > 0 ? `
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                            ${filteredProjects.map(generateProjectCard).join('')}
                        </div>
                    ` : `
                        <div class="text-center p-12 bg-white rounded-xl shadow-lg border border-gray-200">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                            <h3 class="mt-2 text-xl font-medium text-gray-900">No projects found</h3>
                            <p class="mt-1 text-gray-500">
                                Try a different search term or be the first to <a href="#" onclick="window.currentState.view='upload'; window.renderApp();" class="text-emerald-600 font-semibold hover:text-emerald-500 transition duration-200">upload a project</a>!
                            </p>
                        </div>
                    `}
                </section>
                
                <!-- Secondary CTA Section (Green/Blue Accent) -->
                <section class="bg-gradient-to-r from-emerald-700 to-emerald-800 p-12 my-10 shadow-inner">
                    <div class="container mx-auto text-center">
                        <h2 class="text-4xl font-extrabold text-white mb-4">
                            Ready to Build Your Vision?
                        </h2>
                        <p class="text-xl text-emerald-200 mb-8">
                            ELIJUL GROUPS LTD provides end-to-end web and software development services. Let's discuss your custom project.
                        </p>
                        <a href="https://www.gloex.org" target="_blank" class="green-button bg-white text-emerald-800 font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-100 focus:ring-4 focus:ring-white shadow-xl transition duration-300">
                            REQUEST A CONSULTATION
                        </a>
                    </div>
                </section>
            `;
        };

        // 2. Project Details View
        const renderProjectDetails = () => {
            const project = window.currentState.projects.find(p => p.id === window.currentState.selectedProjectId);
            
            if (!project) {
                showMessage("Project not found.", 'error');
                window.currentState.view = 'dashboard';
                window.renderApp();
                return;
            }

            appContainer.innerHTML = `
                <section class="container mx-auto px-4 py-12">
                    <!-- Back Button (Green Link) -->
                    <a href="#" onclick="window.currentState.view='dashboard'; window.renderApp(); return false;" class="inline-flex items-center text-emerald-700 hover:text-emerald-900 font-semibold mb-8 transition duration-300">
                        <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                        Back to All Projects
                    </a>

                    <div class="bg-white p-8 rounded-xl shadow-2xl border-t-4 border-emerald-500">
                        <!-- Project Header -->
                        <h1 class="text-4xl font-extrabold text-gray-900 mb-2">${project.title}</h1>
                        <p class="text-lg text-gray-500 mb-6">Submitted by: <span class="font-semibold text-emerald-600">${project.author}</span></p>

                        <!-- Image and Details Grid -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                            <!-- Image/Media & Description -->
                            <div class="lg:col-span-2 space-y-8">
                                <img src="${project.image}" alt="${project.title}" class="w-full h-auto rounded-lg shadow-xl" onerror="this.onerror=null; this.src='https://placehold.co/800x450/ccc/000?text=Project+Image+Demo'">
                                
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-800 mb-3 border-b pb-2">Project Overview</h3>
                                    <p class="text-gray-700 leading-relaxed">${project.description}</p>
                                </div>
                            </div>
                            
                            <!-- Sidebar (Metadata & CTAs) -->
                            <div class="lg:col-span-1 bg-gray-50 p-6 rounded-lg shadow-inner">
                                <h3 class="text-xl font-bold text-gray-800 mb-5 border-b pb-2">Technical Details</h3>

                                <div class="space-y-4 mb-8">
                                    <p><span class="font-semibold text-gray-700">Views:</span> ${project.views || 0}</p>
                                    <p><span class="font-semibold text-gray-700">Submission Date:</span> ${new Date().toLocaleDateString()}</p>
                                </div>
                                
                                <h4 class="text-lg font-semibold text-gray-700 mb-3">Key Technologies:</h4>
                                <div class="flex flex-wrap gap-2 mb-8">
                                    ${(project.tags || []).map(tag => `<span class="text-sm font-semibold px-3 py-1 bg-emerald-100 text-emerald-800 rounded-full">${tag}</span>`).join('')}
                                </div>

                                <!-- Action Buttons (Green) -->
                                <div class="space-y-4">
                                    <a href="${project.demoUrl}" target="_blank" class="green-button block w-full text-center hover:ring-2 hover:ring-offset-2 hover:ring-emerald-500">
                                        <svg class="w-5 h-5 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                                        Visit Live Demo
                                    </a>
                                    <button onclick="window.currentState.view='upload'; window.renderApp();" class="green-button block w-full text-center bg-gray-200 text-gray-800 hover:bg-gray-300">
                                        Contact Author
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        };

        // 3. Upload View (Form for submission - working feature)
        const renderUpload = () => {
            const handleSubmit = (event) => {
                event.preventDefault();
                const formData = new FormData(event.target);
                const projectData = {
                    title: formData.get('title'),
                    description: formData.get('description'),
                    demoUrl: formData.get('demoUrl'),
                    image: formData.get('imageUrl') || 'https://placehold.co/400x250/ccc/000?text=Pending+Image',
                    tags: formData.get('tags').split(',').map(tag => tag.trim()).filter(tag => tag.length > 0),
                    author: userId // Use the actual user ID or a better placeholder
                };
                
                window.submitNewProject(projectData);
            };

            appContainer.innerHTML = `
                <section class="container mx-auto px-4 py-12">
                    <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-2xl border-t-4 border-rose-500">
                        <h2 class="text-4xl font-extrabold text-gray-900 mb-2 text-center">Submit Your Demo</h2>
                        <p class="text-center text-lg text-gray-600 mb-8">Fill out the details below to share your project with the community.</p>

                        <form id="uploadForm" onsubmit="handleSubmit(event)" class="space-y-6">
                            
                            <!-- Project Title -->
                            <div>
                                <label for="title" class="block text-sm font-medium text-gray-700">Project Title</label>
                                <input type="text" id="title" name="title" required placeholder="e.g., Ultra-Fast Python Backend API"
                                       class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-emerald-500 focus:border-emerald-500">
                            </div>

                            <!-- Description -->
                            <div>
                                <label for="description" class="block text-sm font-medium text-gray-700">Detailed Description</label>
                                <textarea id="description" name="description" rows="5" required placeholder="Provide a detailed explanation of your project, its features, and the technology stack used."
                                          class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></textarea>
                            </div>

                            <!-- Demo URL -->
                            <div>
                                <label for="demoUrl" class="block text-sm font-medium text-gray-700">Live Demo or Repository URL (MUST be a valid URL)</label>
                                <input type="url" id="demoUrl" name="demoUrl" required placeholder="https://github.com/your-project"
                                       class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-emerald-500 focus:border-emerald-500">
                            </div>

                            <!-- Image URL -->
                            <div>
                                <label for="imageUrl" class="block text-sm font-medium text-gray-700">Project Image URL (Optional, for better showcase)</label>
                                <input type="url" id="imageUrl" name="imageUrl" placeholder="https://i.imgur.com/project-screenshot.png"
                                       class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-emerald-500 focus:border-emerald-500">
                            </div>

                             <!-- Tags -->
                            <div>
                                <label for="tags" class="block text-sm font-medium text-gray-700">Tags (Comma separated, e.g., React, Tailwind, Python)</label>
                                <input type="text" id="tags" name="tags" required placeholder="WebDev, AI, DataViz"
                                       class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-emerald-500 focus:border-emerald-500">
                            </div>

                            <!-- Submission Button (Green) -->
                            <button type="submit" 
                                    class="green-button w-full flex justify-center py-3 px-4 rounded-lg shadow-xl text-lg font-bold hover:ring-4 hover:ring-offset-2 hover:ring-emerald-300 transition duration-300">
                                <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                                Submit Demo for Review
                            </button>
                        </form>
                    </div>
                </section>
            `;
            // Attach the submit handler after the form is rendered
            document.getElementById('uploadForm').onsubmit = handleSubmit;
        };

        // --- Main Application Renderer (Core Feature) ---
        window.renderApp = () => {
            // Show loading spinner while Firebase is connecting
            if (!window.currentState.isAuthReady) {
                 appContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center min-h-[50vh] text-emerald-600">
                        <svg class="animate-spin h-10 w-10 text-emerald-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="text-lg font-semibold">Connecting to Data Hub...</p>
                    </div>
                 `;
                 return;
            }

            // Route to the correct view (working feature)
            switch (window.currentState.view) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'project-details':
                    renderProjectDetails();
                    break;
                case 'upload':
                    renderUpload();
                    break;
                default:
                    // Default to dashboard if state is invalid
                    window.currentState.view = 'dashboard';
                    renderDashboard();
                    break;
            }
        };

        // Initial render when the page loads
        document.addEventListener('DOMContentLoaded', window.renderApp);
    </script>

</body>
</html>
